# üöÄ Kubernetes Cluster Initialization Script

<p align="center">
<a href="https://github.com/reimon"><img title="Author" src="https://img.shields.io/badge/Author-DeepSociety-svg?style=for-the-badge&logo=github"></a>
<a href="#"><img title="Open Source" src="https://img.shields.io/badge/Open%20Source-%E2%9D%A4-green?style=for-the-badge"></a>
</p>

![Kubernetes Logo](https://kubernetes.io/images/kubernetes-horizontal-color.png)

Este reposit√≥rio cont√©m um script para inicializar um cluster Kubernetes usando kubeadm, com containerd como runtime e configura√ß√µes de rede necess√°rias.

### üìã Pr√©-requisitos

Antes de executar o script, certifique-se de ter:

- Acesso root ou sudo no sistema
- Sistema operacional baseado em Linux (testado no Ubuntu 22.04)
- git instalado (apt-get install git -y )

# Configura√ß√£o da INFRA no Azure

Este guia descreve os comandos necess√°rios para criar um grupo de recursos, uma rede virtual e uma m√°quina virtual no Azure, incluindo a configura√ß√£o necess√°ria para um cluster Kubernetes.

## Comandos

### 1. Criar um Grupo de Recursos

```sh
az group create --name cluster-k8s --location brazilSouth
```

--az group create: Cria um novo grupo de recursos no Azure.
--name cluster-k8s: Define o nome do grupo de recursos como "cluster-k8s".
--location brazilSouth: Especifica a localiza√ß√£o do grupo de recursos como "Brazil South".

### 2. Criar uma Virtual Network

Este comando criar√° a VNet "VNET-K8S" no grupo de recursos "cluster-k8s" na regi√£o "Brazil South".

```sh
az network vnet create --resource-group cluster-k8s --name VNET-K8S --address-prefix 10.0.0.0/16 --location brazilSouth
```

-- `az network vnet create`: Comando para criar uma Virtual Network no Azure.
-- `resource-group cluster-k8s`: Especifica o grupo de recursos onde a VNet ser√° criada.
-- `name VNET-K8S`: Define o nome da VNet como "VNET-K8S".
-- `address-prefix 10.0.0.0/16`: Define o prefixo de endere√ßo da VNet.
-- `location brazilSouth`: Especifica a localiza√ß√£o da VNet como "Brazil South".

### 3. Criar uma VM no Azure

```sh
az vm create \
  --resource-group cluster-k8s \
  --name VM-K8S-CP \
  --image Canonical:0001-com-ubuntu-minimal-jammy:minimal-22_04-lts-gen2:22.04.202305240 \
  --size Standard_B2s \
  --vnet-name VNET-K8S \
  --subnet default \
  --public-ip-address "" \
  --public-ip-address-allocation static \
  --public-ip-sku Standard \
  --os-disk-size-gb 30 \
  --os-disk-type StandardSSD_LRS \
  --admin-username svc_Linux \
  --admin-password FIAP@MBA@K8S@2024! \
  --location brazilSouth
```

`--az vm create`: Cria uma nova m√°quina virtual no Azure.
--resource-group cluster-k8s: Especifica o grupo de recursos.
--name VM-K8S-CP: Define o nome da VM.
--image Canonical:0001-com-ubuntu-minimal-jammy:minimal-22_04-lts-gen2:22.04.202305240: Usa a imagem Ubuntu 22.04 minimal gen2.
--size Standard_B2s: Especifica o tamanho da VM com 2 vCPUs e 4 GiB de RAM.
--vnet-name VNET-K8S: Conecta a VM √† VNet existente.
--subnet default: Usa a sub-rede padr√£o.
--public-ip-address "": Cria um IP p√∫blico para a VM.
--public-ip-address-allocation static: Define o IP p√∫blico como est√°tico.
--public-ip-sku Standard: Usa o SKU Standard para o IP p√∫blico.
--os-disk-size-gb 30: Define o tamanho do disco do SO para 30 GB.
--os-disk-type StandardSSD_LRS: Usa o tipo de disco SSD Standard.
--admin-username svc_Linux: Define o nome de usu√°rio administrador.
--admin-password FIAP@MBA@K8S@2024!: Define a senha do usu√°rio administrador.
--location brazilSouth: Especifica a localiza√ß√£o..
-- location brazilSouth: Especifica a localiza√ß√£o.

### üîß Instala√ß√£o do Kubernetes

Clone este reposit√≥rio e navegue at√© o diret√≥rio:

```bash
git clone https://github.com/reimon/Create-Kubernetes-Cluster.git
cd Create-Kubernetes-Cluster

chmod +x setup_k8s_cluster
./setup_k8s_cluster
```

## Passos do Script

### 1. Carregamento dos M√≥dulos Necess√°rios

Carregamos os m√≥dulos overlay e br_netfilter necess√°rios para o funcionamento do Kubernetes.

### 2. Configura√ß√£o dos Par√¢metros sysctl

Configura√ß√µes sysctl s√£o aplicadas para permitir o roteamento de pacotes IP e o processamento de iptables no tr√°fego de ponte de rede.

### 3. Instala√ß√£o do containerd

O runtime containerd √© instalado e configurado.

### 4. Desativa√ß√£o do Swap

O swap √© desativado.

### 5. Instala√ß√£o das Depend√™ncias do Kubernetes

Instalamos o kubeadm, kubelet e kubectl nas vers√µes especificadas.

### 6. Inicializa√ß√£o do Cluster Kubernetes

Finalmente, inicializamos o cluster Kubernetes com o kubeadm.

### 7. Configura√ß√£o do Diret√≥rio .kube

O script cria o diret√≥rio .kube e copia o arquivo de configura√ß√£o do Kubernetes para ele.

### 8. Aplica a configura√ß√£o de rede Calico

```sh
kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml

```

Contribui√ß√µes
Sinta-se √† vontade para abrir issues e pull requests para melhorias e corre√ß√µes.

## üìÑ Licen√ßa

Este projeto est√° licenciado sob a Licen√ßa MIT. Consulte o arquivo LICENSE para mais informa√ß√µes.
